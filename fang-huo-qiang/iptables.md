## 概述

- 位于/sbin/iptables下，**无需安装**，个别情况则**yum**或**apt**安装使用
- 基于内核内置四个规则表，配置后立即生效，无需重启

## 四表五链

- 表的作用：容纳各种规则链
- 链的作用：容纳各种规则
- **总结**：表中有链，链中有规则

### 四个表
- ***raw***：确定是否对该数据包进行状态跟踪，包括两个规则链：OUTPUT、PREROUTING
- ***mangle***：修改数据包内容，用来做流量整形的，给数据包设置标记。包含五个规则链，INPUT、OUTPUT、FORWARD、PREROUTING、POSTROUTING。
- ***nat***：负责网络地址转换，用来修改数据包中的源、目标IP地址或端口。包含三个规则链，OUTPUT、PREROUTING、POSTROUTING。
- ***filter***：负责过滤数据包，确定是否放行该数据包（过滤）。包含三个规则链，INPUT、FORWARD、OUTPUT。

### 五链

- **INPUT**：处理入站数据包，匹配目标IP为本机的数据包
- **OUTPUT**：处理出站数据包，一般不在此链上做配置。
- **FORWARD**：处理转发数据包，匹配流经本机的数据包。
- **PREROUTING链**：在进行路由选择前处理数据包，用来修改目的地址，用来做DNAT。相当于把内网服务器的Ip和端口映射到路由器的外网Ip和端口上。
- **POSTROUTING链**：在进行路由选择后处理数据包，用来修改源地址，用来做SNAT。相当于内网通过路由器NAT转换功能实现内网主机通过一个公网IP地址。

## iptables命令

### 命令格式
`iptables[-t 表名] 管理选项 [链名] [匹配条件] [-j 控制类型]`
==注意==
1. 不指定表名时，默认指filter表
2.不指定链名时，默认指表内所以链
3.除非设置链的默认策略，否则必须指定匹配条件
4.控制类型使用大写字母，其余均为小写字母

### 常用控制类型
- ACCEPT：允许数据包通过
- DROP：直接丢弃数据包，不给任何回应
- REJECT：拒绝数据包通过，会给数据发送端一个响应信息
- SNAT：修改数据包的源地址
- DNAT：修改数据包的目的地址
- MASQUERADE：伪装成一个非固定公网地址
- LOG：在/var/log/message文件中记录日志信息，然后将数据包传递给下一条规则。LOG只是一种辅助动作，并没有真正处理数据包

### 常用选项
- A：在指定链的末尾追加（--append）一条新的规则
- I：在指定链的开头插入（--insert）一条新的规则，未指定序号时默认作为第一条规则
- R：修改、替换（--replace）指定链中的某一条规则，可指定规则序号或具体内容
- P：设置指定链的默认策略（--policy）
- D：删除（--delete）指定链中的某一条规则，可指定规则序号或具体内容
- F：清空（--flush）指定链中的所有规则，若未指定链名，则清空表中的所有链
- L：列出（--list）指定链中所有的规则，若未指定链名，则列出表中的所有链
- n：使用数字形式（--numeric）显示输出结果，如显示IP地址而不是主机名
- v：显示详细信息，包括每条规则的匹配包数量和匹配字节数--1ine-numbers：查看规则时，显示规则的序号

### 常用命令
#### 查看规则
```shell
iptables -nL
或
iptables -n -L
```
