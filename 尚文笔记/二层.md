#   以太网背景
###   为了实现局域网内计算机之间的通信，以太网采用了一种广播的工作方式，即当一台计算机要发送数据时，将数据发送到与之相连的所有计算机，然后由接收方计算机判断是否是发送给自己的数据，如果是则接收，否则丢弃。

# 数据发送机制

# CSM/CD（载波侦听多路访问/冲突检测）
-   载波侦听：在发送数据之前，先侦听信道是否空闲，如果空闲则发送数据，否则等待信道空闲后再发送。
-   冲突检测：在发送数据过程中，如果检测到信道中存在其他计算机也在发送数据，则停止发送，等待一段时间后再次尝试发送。
-   同一个网段所有节点处于同一个冲突域中，即一个冲突域内所有节点都可以直接通信。只工作在半双工
-   现代网络使用交换机，每个接口都是一个冲突域全双工的，所以不需要CSM/CD
-   

#   MAC地址
###   MAC地址是网络设备在数据链路层上的唯一标识，由48位二进制数组成，通常以6个十六进制数表示，例如：00-1B-63-84-45-50。MAC地址由设备制造商在生产时分配，用于标识网络设备，例如计算机、路由器、交换机等。前24位是组织唯一标识符（OUI），由IEEE分配给设备制造商，后24位是制造商分配的序列号。

# 以太网帧及帧类型
- 单播帧：目的MAC地址为单个设备的MAC地址。
- 广播帧：目的MAC地址为全F的MAC地址。所有节点都会接收到广播帧。
- 组播帧：目的MAC地址为特定组播组的MAC地址。只有属于该组播组的节点会接收到组播帧。




#   二层交换机原理

## MAC地址表：
交换机内部维护了一张MAC地址表，用于记录每个接口所连接设备的MAC地址。当交换机收到一个数据帧时，会根据目的MAC地址查找MAC地址表，如果找到对应的接口，则将数据帧从该接口发送出去；如果找不到对应的接口，则将数据帧广播到除接收接口外的所有接口。

***工作原理***：交换机在接收到数据帧时，会记录下源MAC地址和对应的接口，并将其添加到MAC地址表中。当交换机再次收到相同源MAC地址的数据帧时，可以直接从MAC地址表中查找对应的接口，而不需要再次广播。这样可以提高数据传输的效率。若表中没有，则广播，大量广播会泛洪。

*****更新*****：
1. 老化时间，默认5分钟、300秒，超过老化时间，则删除该条目
2. 后到先更新，如果MAC地址表中已经存在该MAC地址的条目，则更新该条目，否则添加新的条目。覆盖
   
## VLAN（虚拟局域网）：
将一个物理网络划分为多个逻辑网络，每个逻辑网络称为一个VLAN。每个VLAN都有自己的MAC地址表，这样就可以实现不同VLAN之间的隔离，防止广播风暴。不同组的设备可以属于不同的VLAN，从而实现网络资源的合理分配和管理及提高安全性。

封装：802.1Q协议，在以太网帧中添加4字节的VLAN标签，用于标识VLAN ID。

## 交换机端口类型：
-   Access：用于连接计算机或其他终端设备，只能属于一个VLAN。交换机识别接口所属VLAN，并转发到该VLAN的接口。
-   Trunk：用于连接其他交换机或路由器，可以允许多个VLAN的数据通过。转发时，需要添加VLAN标签。（notive vlan除外）
    -   Notive：用于连接其他交换机或路由器，可以允许多个VLAN的数据通过。转发时，不添加VLAN标签。双方一致，否则转发错误导致丢包和串流。


# VLAN间通信：三层设备，跨广播域通信。三层交换机，路由器
-   路由器：功能丰富，接口类型丰富，CPU软件转发，转发速度慢。
-   三层交换机：接口数量多，转发速度快，CPU硬件转发。

## 单臂路由：
-   将交换机的某个接口配置为Trunk接口，并允许所有VLAN的数据通过。
-   在路由器上配置子接口，每个子接口对应一个VLAN，并配置对应的IP地址。
-   在交换机上配置VLAN映射，将不同VLAN的数据帧封装成单臂路由的子接口的数据帧，并添加VLAN标签。
-   在路由器上配置VLAN映射，将单臂路由的子接口的数据帧解封装，并转发到对应的VLAN接口。
-   

```
interface GigabitEthernet0/0/1
switchport mode trunk
switchport trunk allowed vlan all
```

```
interface GigabitEthernet0/0/1.10
encapsulation dot1Q 10
ip address 192.168.10.254 255.255.255.0
```

## SVI：交换机虚拟接口，每个VLAN对应一个SVI接口，用于实现VLAN间的通信。

条件：交换机必须支持三层功能，即具有路由功能。必须先创建VLAN，再创建SVI接口。需将vlan绑定接口，确保接口激活，否则无法通信。


```
interface Vlan 10
ip address 192.168.10.254 255.255.255.0
```




