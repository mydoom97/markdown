# 环路的危害
1. 不断占用带宽和交换机资源，造成网络拥塞，导致断网
2. 交换机不断转发，造成MAC地址表混乱，导致网络瘫痪，MAC地址表震荡，是典型表现
3. PC和网关设备会不断收到大量广播包，导致卡顿

# 生成树协议

通过自己的计算网络中是否存在环路，若存在则拥塞某些接口，从而阻止环路

拥塞接口可在物理接口故障时，自动恢复，从而保证网络的可靠性

> 工作原理：选举根桥、根端口、指定端口、阻塞端口

> 根桥：生成树协议中，网络中拥有最小桥ID的交换机被选举为根桥。***桥ID=优先级+MAC地址***，优先级默认32768，MAC地址为交换机MAC地址，以4096为单位递增。最小的桥ID即为根桥

> 根端口：每个非根交换机上都会选举一个到达根桥的端口，该端口即为根端口。根端口选举规则：***到达根桥路径开销+端口ID***，路径开销越小，根桥ID越小，端口ID越小，则优先级越高。***端口ID=端口优先级+端口编号***，端口优先级默认128，端口编号为端口号，以16为单位递增。*****每个设备必须有一个*****

> 路径开销：基于带宽每条线路会有一个路径开销，带宽越大开销越小，根路径开销是指本地到根桥的所有开销之和 

> 指定端口：根桥上的左右端口都是指定端口，每条线路上都有一个，路径开销越小，根桥ID越小，端口ID越小，则优先级越高。从设备出发，***每条线必须有一个***

> BPDU:桥协议数据单元，用于交换机之间传递生成树协议信息，每2秒从根桥发送一次，***指定端口发送BPDU，根端口收***
>
## STP端口状态
1. Disabled：禁用状态，端口不可用

2. Blocking：阻塞状态，端口不转发数据，只接收BPDU，丢弃收到的数据帧。不学习MAC地址且不产生MAC地址表项

3. Listening：监听状态，持续15秒，接受并发送BPDU，不转发数据，不产生MAC地址表项，该状态完成STP收敛，此状态交换机决定根桥，并选择根端口、指定端口和非指定端口

4. Learning：学习状态，持续15秒，接受并发送BPDU，不转发数据，学习MAC地址，不产生MAC地址表项

5. Forwarding：转发状态，端口转发数据，接收BPDU，学习MAC地址，生成MAC地址表项