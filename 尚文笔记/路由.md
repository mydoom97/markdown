# 跨广播域通信，使用路由器选择最优路径
## 1.为什么：
## 2.定义：根据路由表，选择最优路径。路由表是最优路径表，记录了到达目标网络的最优路径，通过下一跳\出接口，找到目标网络
## 3.路由表：
### 3.1 路由表分类：
#### 3.1.1 直连路由：与路由器直连的网段，直接通过出接口到达目标网络
#### 3.1.2 静态路由：手动配置，不依赖路由协议。只适合小型网络，无法自动适应网络变化。优点：配置简单，稳定可靠。安全，消耗资源少。
#### 3.1.3 动态路由：依赖路由协议，自动生成路由表。适合大型网络，可以自动适应网络变化。缺点：配置复杂，消耗资源多。不稳定，安全性低。

### 3.2 内容:
####  锐捷命令：show ip route

### 3.3 管理距离：路由协议优先级，越小越优先。默认值：0-255，越小越优先。管理距离越小，优先级越高。
-   直连路由：0
-   静态路由：1
-   动态路由：5
-   OSPF：10
-   RIP：120

### 3.4 度量值：路由协议计算到达目标网络最优路径的权重。越小越优先。默认值：0-65535，越小越优先。度量值越小，优先级越高。不同协议度量值单位不同。无法比较不同协议的度量值。只能同一协议比较度量值。用来衡量最优路径的优劣，又叫开销。

### 3.5 路由加表原则：只有最优网络才会加表。管理距离相同，度量值小的优先。管理距离不同，管理距离小的优先。
1.  比较目标网络，相同目标网络，
2.  比较管理距离，管理距离小的优先。
3.  比较度量值，度量值小的优先。
4.  如果管理距离和度量值都相同，则负载分担。

### 3.6 路由表用表原则：最长子网掩码 优先。子网掩码越长，优先级越高。


## 4.静态路由：
### 4.1 配置：
-   基本配置：
    -   ip route 目标网络 子网掩码 下一跳
    -   ip route 目标网络 子网掩码 出接口
-   特殊配置：
    -   默认路由：ip route 0.0.0.0 0.0.0.0 下一跳 //可匹配所有网络，优先级最低，度量值最大，最后匹配。
    -   本地路由：ip route 目标网络 子网掩码 本地接口
    -   反掩码：ip route 目标网络 反掩码 下一跳
-   



下层为上层提供服务
1：应用层：：用户打开浏览器输入网址，浏览器解析出对应的域名，向DNS服务器发送请求信息，请求域名对应的IP地址
2：传输层：：发送DNS请求，因此DNS采用UDP来进行快速查询， 源端口号随机 目的端口号53
3：网络层：：封装源IP是自身，目的IP地址是DNS服务器地址
4：数据链路层：：封装源MAC为自身，但是没有目的MAC。通过子网划分发现DNS服务器和本身不在同一广播域，直接找网关IP对应的mac。
     查找缓存表，发现没有网关IP对应的mac
     PC发送ARP广播查询
     网关单播回应ARP查询并记录PC的IP和mac对应信息
     PC收到回应更新缓存表并发送给网关
5：物理层：通过网线传输二进制信号给网关
6：网关发出信号，中间设备不断修改mac地址，实现逐跳转发给DNS服务器
7：DNS服务器也通过逐跳转发回应百度的IP给PC
8：从网关转发到路由器，路由器解封装到网络层，根据路由表查询最优路径，找到下一跳。在由ARP封装下一跳的mac地址，再由数据链路层封装源mac地址，再由物理层传输给下一跳。

# 浮动静态路由：在静态路由基础上，加上管理距离，距离越小，优先级越高。 
## 1.为什么：当主路由失效时，浮动静态路由生效，保证网络不中断。
## 2.定义：当主路由失效时，浮动静态路由生效，保证网络不中断。
## 3.配置：ip route 目标网络 子网掩码 下一跳 preference 优先级