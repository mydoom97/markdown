# 以下是Centos7.9的网络配置出自红帽官方文档整理

-----

## 1.配置DHCP客户端

在CentOS 7中，默认使用NetworkManager来管理网络配置。NetworkManager是一个网络配置工具，它使用DHCP协议来分配IP地址和其他网络配置参数。

### 1.1 请求IP地址

当 DHCP 连接启动时，dhcp 客户端会从 DHCP 服务器请求 IP 地址。默认情况下，dhcp 客户端等待此请求完成的时间为 60 秒。您可以使用 nmcli 工具或 /etc/sysconfig/network -scripts/ifcfg-ifname文件中的 IPV4_DHCP_TIMEOUT 选项来配置ipv4.dhcp- timeout 属性。例如，使用 nmcli:

```
nmcli connection modify enp1s0 ipv4.dhcp-timeout 10
```

### 1.2 使DHCPv4持久

要使 DHCPv4 在启动和租期续订过程中持久化，请将 ipv4.dhcp-timeout 属性设置为 32 位整数(MAXINT32)的最大值，即 2147483647 或 infinity 值：

```
nmcli connection modify enp1s0 ipv4.dhcp-timeout 2147483647
```

nmcli connection modify enps1s0 ipv4.dhcp-timeout infinity
因此，NetworkManager 永远不会停止尝试从 DHCP 服务器获取或续订租期，直到成功为止。

要确保仅在租期续订过程中有 DHCP 持久性行为，您可以在 /etc/sysconfig/network-scripts/ifcfg- enp1s0 配置文件中使用 nmcli 手动将静态 IP 添加到 /etc/sysconfig/network-scripts/ifcfg- enp1s0 配置文件中的 IPADDR 属性中：

```
nmcli connection modify enp1s0 ipv4.address 192.168.122.88/24
```

当 IP 地址租用到期时，静态 IP 会保留已配置或部分配置的 IP 状态（您可以拥有 IP 地址，但您未连接到互联网），确保 dhcp 客户端每 2 分钟重新启动一次。

-----

## 2. 配置netconsole

如果磁盘日志记录失败或使用串行控制台，您可能需要使用内核调试。netconsole 内核模块允许通过网络将内核消息记录到另一台计算机。
为了能够使用 netconsole，您需要具有一个在网络上正确配置的 rsyslog 服务器。

#### 2.1 为netconsole配置rsyslog

1. 将 rsyslogd 守护进程配置为侦听 514/udp 端口，并通过取消注释 /etc/rsyslog.conf 文件的 MODULES 部分中的以下行从网络接收信息：

```
$ModLoad imudp
$UDPServerRun 514
```

2. 重启 rsyslog 服务：

```
systemctl restart rsyslog
```

3. 验证 rsyslogd 是否在侦听 514/udp 端口：

```
netstat -l | grep syslog
```

#### 2.2 配置发送机器

1. 在/etc/sysconfig/netconsole 文件中设置 SYSLOGADDR 变量的值，以匹配 syslogd 服务器的 IP 地址。例如：

```
SYSLOGADDR=192.168.1.100
```

2. 重启 netconsole 服务以使更改生效,并使netconsole服务开机自启：
```
systemctl restart netconsole
systemctl enable netconsole
```

3. 在 /var/log/messages 文件中或 rsyslog.conf 中指定的文件中查看来自客户端的 netconsole 消息。
```
cat /var/log/messages
```