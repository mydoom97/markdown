# 硬盘分区：MBR、GPT

## MBR：为传统分区方案，<=2T

> 仅支持BIOS启动，良好的兼容性适应大部分系统。
> 
> 分区最大2TB。
> 
> 无冗余校验。引导易损，导致无法启动。

### 主分区

特点：最多只能<mark>4</mark>个主分区。其中一个可设置为活动分区，用于引导系统。主分区可直接格式化为文件系统并挂载

作用：引导启动操作系统，存放操作系统的启动或引导程序，/boot分区尽量放在主分区上

### 扩展分区

特点：最多只有<mark>1</mark>个扩展分区。为突破主分区的数量限制

作用：不可存储数据，仅作为逻辑分区的载体。有自己的分区表用于管理逻辑分区

### 逻辑分区

特点：是扩展分区内的分区，理论上没有数量限制。仅在MBR分区表中有效，不可将系统安装在逻辑分区上。必须位于扩展分区内，若扩展分区损坏则所有的逻辑分区皆受影响

作用：存储数据。以扩展分区载体基础，**只存储数据不能引导启动系统**。

---

## GPT：为现代分区方案，>=2T

> 支持UEFI启动，也支持BIOS但是需要win10等新系统，在BIOS引导上使用GPT时仅作为数据盘而无法引导启动。
> 
> 最多128个分区，分区最大18EB。
> 
> 使用CRC32校验，支持数据冗余和恢复。

### 各个分区之间平等，使用GUID进行标识

---

### 分区编号

###### MBR

1. 主分区
   
   编号为1到4，若4个主分区都使用则无法创建主分区，例如
   
   - `/dev/sda1`（第一个主分区）
   - `/dev/sda2`（第二个主分区）
   - `/dev/sda3`（第三个主分区）
   - `/dev/sda4`（第四个主分区）

2. 扩展、逻辑分区
   
   - 扩展分区本身占用一个主分区编号（例如`/dev/sda4`）。
   - 逻辑分区的编号从5开始，例如：
     - `/dev/sda5`（第一个逻辑分区）
     - `/dev/sda6`（第二个逻辑分区）
     - `/dev/sda7`（第三个逻辑分区）
   - 逻辑分区的编号可以无限增加（实际受操作系统限制）。

###### GPT

- GPT分区表支持最多128个主分区（具体数量可能因操作系统而异）。
- 分区编号从1开始，例如：
  - `/dev/sda1`（第一个主分区）
  - `/dev/sda2`（第二个主分区）
  - `/dev/sda3`（第三个主分区）
- 分区编号可以连续分配，直到达到最大分区数量。

---

# Linux系统中的硬盘

> linux系统中使硬盘可用的大概步骤为：分区---格式化----创建挂载点-----挂载

### 命名方式：/dev/sd（a-z）数字

    /dev，表示在dev目录下，dev目录存放设备文件（如硬盘、U盘、光驱等），这些文件是操作系统与硬件交互的接口

    a-z，表示设备序号，如sda为第一块盘，sdb为第二块等等

        注意：第26磁盘：sdz 第27块磁盘：sdaa 第28块磁盘：sdab

    n，表示分区编号

### 查看块设备（硬盘、分区、挂载点等）

```shell
lsblk
```

###### 常用参数

- `-f`显示文件系统、UUID、挂载点等

- `-a`显示所有设备，包括空设备

- `-m`显示设备所有者及所有者信息

- `-l`以树状结构显示

### 管理磁盘分区：<mark>fdisk</mark>

```shell
fdisk 参数  设备名
```

此命令会进入交互式命令行

###### 1.查看分区表：`p`

```shell
Command (m for help): p
```

###### 2.创建新分区：`n`

```shell
Command (m for help): n
```

- 选择分区类型（主分区 `p` 或扩展分区 `e`）。
- 设置分区编号、起始扇区和结束扇区。

> 创建分区步骤：输入`n`后，选择`p`或`e`，选择为主分区/扩展分区

1. 选择分区号，主分区为（1-4），，逻辑分区从5开始（1到4保留给主分区不使用）

2. 设置起始扇区，此处回车默认即可

3. 设置结束扇区，此处输入`+需要的容量`即可。此处亦可回车则将剩余空间全部分配

###### 3.删除分区：`d`

```shell
Command (m for help): d
```

###### 4.查看帮助：`m`

```shell
Command (m for help): m
```

###### 5.保存并退出：`w`

```shell
Command (m for help): w
```

###### 6. 放弃更改并退出：`q`

```shell
Command (m for help): q
```

---

### 更改文件系统

```shell
mkfs 选项 设备名
```

将一个分区或磁盘格式化为特定的文件系统（ext4、xfs等）

#### 用法

1.直接指定某文件系统进行格式化，输入`mkfs`查询

```shell
mkfs.文件系统 设备名
```

**2.选项指定**

```shell
mkfs -t 文件类型 设备名
```

**3.强制指定**

```shell
mkfs.文件系统 -f 设备名
```

---

### 挂载

**1.创建挂载点**

    创建目录

**2.挂载**

```shell
mount /硬盘分区 挂载的目录位置
```

**3.查看挂载**

```shell
df -h
```

### 卸载

```shell
unmount /硬盘分区
```

### 开机挂载（改文件）

**1.编辑配置文件**

```shell
vim /etc/fstab
```

```shell
/dev/sdb1      /sdb1 xfs        defaults 0      0 
要挂载的分区设备 挂载点 文件系统类型 挂载选项  是否备份 是否检测
```

**2.自动读取文件`/etc/fstab`中未挂载的分区**

```shell
mount -a
```

#### UUID挂载

UUID是唯一值，不会因重新挂载等问题而更改。同样以写入文件进行挂载。

**1.查看UUID值**

```shell
blkid
```

配置文件中将分区设备的位置更改为，`UUID=UUID值`

---

## gdisk，划分容量>2T的硬盘

主要是用来划分<mark>GPT</mark>分区，容量大于2T的硬盘

```shell
gdisk  参数  设备名
```

此命令会进入交互式命令行

###### 1.查看分区表：`p`

```shell
Command (m for help): p
```

###### 2.创建新分区：`n`

```shell
Command (m for help): n
```

> 设置分区编号、起始扇区和结束扇区。

1. 选择分区号

2. 设置起始扇区，此处回车默认即可

3. 设置结束扇区，此处输入`+需要的容量`即可。此处亦可回车则将剩余空间全部分配

4. 设置分区类型，此处回车默认即可，8300为Linux文件系统（ext4/xfs）
   
   | **用途**               | **Hex code** | **GUID**                               |
   | -------------------- | ------------ | -------------------------------------- |
   | Linux 文件系统（ext4/xfs） | `8300`       | `0FC63DAF-8483-4772-8E79-3D69D8477DE4` |
   | EFI 系统分区             | `ef00`       | `C12A7328-F81F-11D2-BA4B-00A0C93EC93B` |
   | Linux 交换分区（swap）     | `8200`       | `0657FD6D-A4AB-43C4-84E5-0933C84B4F4F` |
   | Microsoft 基本数据分区     | `0700`       | `EBD0A0A2-B9E5-4433-87C0-68B6B72699C7` |
   | BIOS 引导分区            | `ef02`       | `21686148-6449-6E6F-744E-656564454649` |

5. `w`保存

6. `Y`确认写入

7. 重启或按照提示输入命令重新加载硬盘

###### 3.删除分区：`d`

```shell
Command (m for help): d
```

###### 4.查看帮助：`m`

```shell
Command (m for help): m
```

###### 5.保存并退出：`w`

```shell
Command (m for help): w
```

###### 6. 放弃更改并退出：`q`

```shell
Command (m for help): q
```

---

## 扩展SWAP分区

#### 查看swap分区

```shell
swapon -s
```

**1.创建出新的分区**

**2.将新分区格式化为swap分区**

```shell
mkswap 硬盘分区
```

 **3.激活swap分区**

```shell
swapon 硬盘分区
```

**4.停用swap分区**

```shell
swapoff 硬盘分区
```

### *创建交换文件*

```shell
dd if=/dev/zero of=swap_file bs= count=
```

- **`dd`**：用于复制或转换文件的工具。
- **`if=/dev/zero`**：输入文件（Input File），`/dev/zero` 是一个虚拟设备，会无限生成空字符（`\0`）。
- **`of=swap_file`**：输出文件（Output File），即生成的文件名为 `swap_file`。
- **`bs=`**：块大小（Block Size），每次生成单个数据。
- **`count=`**：块数量，总共生成多少块。
- `bs`*`count`=生成的文件大小

将创建的交换文件赋予权限

```shell
chmod 0600 swap
```

---

## 文件的软硬链接：`ln`

### 硬链接

通过inode(索引链接号)进行连接。inode可以对应多个文件名

**作用**：允许一个文件拥有多个有效路径名，以此建立硬链接到重要文件，防止*误删*

如果删除了原文件，只要还有硬链接存在，文件的数据仍然可以访问。只有当最后一个连接被删除后，文件的数据块及目录的连接才会释放。

**不能跨文件系统**：硬链接只能在同一文件系统内创建。

**不支持目录**：大多数文件系统不允许为目录创建硬链接（除了`.`和`..`这种特殊情况）。

> inode 是文件系统用来管理文件的一种机制，它的主要作用是：
> 
> **唯一标识文件**：每个文件都有一个唯一的 inode 编号，通过这个编号可以快速定位和访问文件。
> 
> **存储文件元数据**：inode 中包含了文件的属性和相关信息，而不是文件的内容本身。

**1.创建硬链接**

```shell
ln 源文件 目标文件
```

### 软链接

是一个特殊的文件，它存储了目标文件的路径（可以是绝对路径或相对路径），并通过这个路径间接指向目标文件。

**支持跨文件系统**：软链接可以跨越不同的文件系统创建，而硬链接不能。(命令中携带绝对路径)

**可以链接目录**：软链接可以指向目录，而硬链接通常不能指向目录。

**目标文件删除后失效**：如果目标文件被删除，软链接会变成“悬空链接”（dangling link），无法访问目标文件。

**1.创建软链接**

```shell
ln -s 目标文件  软链接名称
```
